import pandas as pd
from sklearn.preprocessing import StandardScaler
from sklearn.decomposition import PCA
from sklearn.cluster import KMeans
from sklearn.metrics import silhouette_score
import matplotlib.pyplot as plt

data = pd.read_csv('Telco-Customer-Churn.csv')
data = data.drop(['customerID'], axis=1)
data = pd.get_dummies(data)
scaler = StandardScaler()
data_scaled = scaler.fit_transform(data)

pca = PCA(n_components=2)
data_pca = pca.fit_transform(data_scaled)
print('Explained variance:', pca.explained_variance_ratio_)

plt.scatter(data_pca[:,0], data_pca[:,1])
plt.title('PCA 2D Scatter')
plt.show()

elbow = []
silhouette = []
for k in range(2, 8):
    km = KMeans(n_clusters=k, random_state=42)
    labels = km.fit_predict(data_pca)
    elbow.append(km.inertia_)
    silhouette.append(silhouette_score(data_pca, labels))

plt.plot(range(2, 8), elbow)
plt.title('Elbow Method')
plt.show()

plt.plot(range(2, 8), silhouette)
plt.title('Silhouette Score')
plt.show()

best_k = 3
km = KMeans(n_clusters=best_k, random_state=42)
labels = km.fit_predict(data_pca)

plt.scatter(data_pca[:,0], data_pca[:,1], c=labels)
plt.title('K-Means Clusters')
plt.show()

data['cluster'] = labels
print(data.groupby('cluster').mean())
